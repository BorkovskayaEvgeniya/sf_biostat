---
title: "HW4"
author: "Borkovskaya_Evgeniya"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
```

## Домашнее задание 3: Использование основных статистических тестов и поправок на множественные сравнения

## Задание 1 (2 балла)

Рассмотрите следующую статистическую гипотезу.

Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

Задайте seed для воспроизводимости результатов (функция set.seed()). Задайте размер выборки sample_size \<- 30. Задайте значение среднего артериального давления до приема нового препарата и после.

Затем:

-   Сформулируйте нулевую и альтернативную гипотезы.

-   Определите уровень значимости.

-   Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

-   Определите наблюдаемое значение статистики, а также критическое значение статистики.

-   Оцените и прокомментируйте статистическую значимость.

    ***Рассмотрим два варианта задачи, так как не до конца понятно, что ожидается в решении (заявленная гипотеза о разницы эффекта нового препарата и стандартной терапии немного не согласуется с дальнейшим условием). Вначале определим, действительно ли новый препарат значимо снижает давление. А далее сравним результаты двух терапий.***

    ***Вначале проверим, действительно ли новый препарат значимо снижает давление.***

```{r, include=TRUE}
# Устанавливаем seed для воспроизводимости результатов
set.seed(40)

# Задаем размер выборки
sample_size <- 30

# Параметры для среднего артериального давления до и изменений после приема препарата
mean_before <- 140  # Среднее артериальное давление до приема препарата
std_before <- 10    # Стандартное отклонение давления до приема препарата
mean_change <- -10   # Среднее изменение давления после препарата
std_change <- 5     # Стандартное отклонение изменения давления

# Генерируем данные
pressure_before <- rnorm(sample_size, mean_before, std_before)
pressure_change <- rnorm(sample_size, mean_change, std_change)
pressure_after <- pressure_before + pressure_change
```

***Нулевая гипотеза (H0):***

***Введение нового препарата не влияет на среднее артериальное давление пациентов с артериальной гипертензией, т.е. разница в среднем артериальном давлении до и после приема препарата равна нулю.***

***Альтернативная гипотеза (H1):***

***Введение нового препарата снижает среднее артериальное давление пациентов с артериальной гипертензией, т.е. среднее артериальное давление после приема препарата ниже, чем до его приема.***

***Уровень значимости зададим 0.01, так как в клинических испытаниях лекарств, требуется более строгий уровень значимости (относительно стандартного значения 0.05), чтобы уменьшить вероятность ложноположительных результатов.***

***Выбор теста зависит от распределения данных и характера переменных. В данном случае, мы сравниваем средние двух зависимых выборок с нормальным распределением (до и после введения препарата для одних и тех же пациентов), что предполагает использование t-теста для зависимых выборок.***

```{r, include=TRUE}
# Выполняем t-тест для зависимых выборок
test_result <- t.test(pressure_before, pressure_after, paired = TRUE)
test_result
```

```{r, include=TRUE}
# Находим критическое значение для альфа = 0.01 и двустороннего теста
round(qt(0.995, 29), 2)
```

***По результатам t-теста для зависимых выборок мы получили следующие значения:***

***Наблюдаемое значение t-статистики: 8.8466***

***p-value: 9.856e-10***

***Так как p-значение значительно меньше уровня значимости 0.01, мы отклоняем нулевую гипотезу. Это означает, что есть статистически значимые доказательства того, что введение нового препарата снижает артериальное давление у пациентов с артериальной гипертензией.***

***Большое значение t-статистики (больше критического) и маленькое p-значение указывают на то, что разница в артериальном давлении до и после приема препарата не является случайной и может быть приписана эффекту нового препарата.***

***Далее сравним, действительно ли внедрение нового препарата в среднем лучше снижает давление пациентов по сравнению со стандартной терапией.***

```{r, include=TRUE}
# Устанавливаем seed для воспроизводимости результатов
set.seed(40)

# Параметры для группы со стандартной терапией
mean_standard <- 7  # Среднее снижение давления для стандартной терапии
std_standard <- 4   # Стандартное отклонение для стандартной терапии

# Параметры для группы с новым препаратом
mean_new_drug <- 10  # Среднее снижение давления для нового препарата
std_new_drug <- 5   # Стандартное отклонение для нового препарата

# Генерация данных для обеих групп
change_standard <- rnorm(sample_size, mean_standard, std_standard)
change_new_drug <- rnorm(sample_size, mean_new_drug, std_new_drug)
```

***Нулевая гипотеза (H0):***

***Среднее снижение артериального давления у группы, получающей новый препарат, не отличается от среднего снижения давления у группы, получающей стандартную терапию.***

***Альтернативная гипотеза (H1):***

***Среднее снижение артериального давления у группы, получающей новый препарат, больше, чем у группы, получающей стандартную терапию.***

***Уровень значимости оставим 0.01.***

***В этом случае, поскольку мы сравниваем средние двух независимых групп, наиболее подходящим будет двухвыборочный t-тест для независимых выборок (данные сгенерированные из нормального распределения).***

```{r, include=TRUE}
# Выполнение двухвыборочного t-теста для независимых выборок
t_test_result <- t.test(change_new_drug, change_standard, alternative = "greater")
t_test_result
```

```{r, include=TRUE}
# Находим критическое значение для альфа = 0.01 и одностороннего теста
round(qt(0.99, 29), 2)
```

***Наблюдаемое значение t-статистики: 4.5988***

***p-value: 1.207e-05***

***Так как p-значение меньше установленного уровня значимости 0.01, а значение t-статистики больше критического значения, мы отклоняем нулевую гипотезу. Это указывает на то, что есть статистически значимые доказательства в пользу альтернативной гипотезы, а именно, что среднее снижение артериального давления в группе, получающей новый препарат, больше, чем в группе, получающей стандартную терапию.***

## Задание 2 (2 балла)

Рассмотрите следующую статистическую гипотезу.

Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2

Рассмотрите два случая: для выборки sample_size1 \<- 100 и выборки sample_size2 \<- 30. Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

Затем:

-   Сформулируйте нулевую и альтернативную гипотезы.

-   Определите уровень значимости.

-   Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

-   Определите наблюдаемое значение статистики, а также критическое значение статистики.

-   Оцените и прокомментируйте статистическую значимость.

***Реализуем решение для случая с размером выборки 100.***

```{r, include=TRUE}
# Устанавливаем seed для воспроизводимости результатов
set.seed(40)

# Установка параметров для выборок
sample_size1 <- 100
prop_smokers <- 0.8
prop_nonsmokers <- 0.2

# Генерация статуса курения (0 - не курит, 1 - курит) # Половина выборки курит, половина - нет
smoking_status <- c(rep(0, sample_size1 / 2), rep(1, sample_size1 / 2))

# Генерация наличия рака легких
cancer_non_smokers <- rbinom(sample_size1 / 2, 1, 0.2)
cancer_smokers <- rbinom(sample_size1 / 2, 1, 0.8)

# Объединение данных о наличии рака в один вектор
cancer_status <- c(cancer_non_smokers, cancer_smokers)

# Создание итоговой таблицы
data <- data.frame(Smoking_Status = smoking_status, Cancer_Status = cancer_status)

# Создание контингентной таблицы
contingency_table <- table(data$Smoking_Status, data$Cancer_Status)

# Переименование строк и столбцов для лучшей читаемости
dimnames(contingency_table) <- list(Smoking_Status = c("Non-Smokers", "Smokers"),
                                     Cancer_Status = c("No Cancer", "Cancer"))

contingency_table
```

***Нулевая гипотеза (H0):***

***Нет связи между курением и развитием рака легких. Любые наблюдаемые различия могут быть объяснены случайностью.***

***Альтернативная гипотеза (H1):***

***Существует связь между курением и развитием рака легких.***

***В данном случае зададим стандартный уровень значимости 0.05.***

***В задаче нужно рассмотреть связь между курением и развитием рака легких с заданными вероятностями заболеваемости для курящих и некурящих. Будем рассмотривать статус курения (курящий/некурящий) и наличие рака легких (есть рак/нет рака) как категориальные переменные. Также стоит отметить, что наблюдения рассматриваем как независимые.***

***Для размера выборки 100 подходит тест хи-квадрат (категориальные независимые данные и более 5 наблюдений в таблице сопряженности для каждого случая).***

```{r, include=TRUE}
# Выполнение хи-квадрат теста
chi_test_result <- chisq.test(contingency_table)
chi_test_result
```

```{r, include=TRUE}
#Находим критическое значение для альфа = 0.05
round(qchisq(0.95, 1), 2)
```

***Наблюдаемое значение статистики X-squared: 4.5988***

***p-value: 1.207e-05***

***Значение p-value меньше заданного уровня значимости 0.05, что указывает на очень низкую вероятность того, что наблюдаемые различия между курящими и некурящими могут быть случайными. Таким образом, мы отклоняем нулевую гипотезу и делаем вывод о наличии статистически значимой связи между курением и развитием рака легких. Наблюдаемое значение статистики значительно превышает критическое значение, подтверждая статистическую значимость результатов.***

***Далее рассмотрим выборку размера 30.***

```{r, include=TRUE}
# Устанавливаем seed для воспроизводимости результатов
set.seed(20)

sample_size2 <- 30

# Генерация статуса курения (0 - не курит, 1 - курит) # Половина выборки курит, половина - нет
smoking_status <- c(rep(0, sample_size2 / 2), rep(1, sample_size2 / 2))

# Генерация наличия рака легких
cancer_non_smokers <- rbinom(sample_size2 / 2, 1, 0.2)
cancer_smokers <- rbinom(sample_size2 / 2, 1, 0.8)

# Объединение данных о наличии рака в один вектор
cancer_status <- c(cancer_non_smokers, cancer_smokers)

# Создание итоговой таблицы
data <- data.frame(Smoking_Status = smoking_status, Cancer_Status = cancer_status)

# Создание контингентной таблицы
contingency_table <- table(data$Smoking_Status, data$Cancer_Status)

# Переименование строк и столбцов для лучшей читаемости
dimnames(contingency_table) <- list(Smoking_Status = c("Non-Smokers", "Smokers"),
                                     Cancer_Status = c("No Cancer", "Cancer"))

contingency_table
```

***В данном случае мы не можем использовать тест X-squared, так как количество наблюдений в таблице сопряженности для двух случаев менее 5. Используем его аналог - точный тест Фишера.***

```{r, include=TRUE}
# Выполнение точного теста Фишера
fisher_test_result <- fisher.test(contingency_table)
fisher_test_result
```

***Наблюдаемое значение p-value: 0.002814***

***odds ratio : 14.11256***

***Ключевым результатом в данном случае является p-value. Значение p-value меньше заданного уровня значимости 0.05, что указывает на то, что вероятность наблюдаемых различий между курящими и некурящими в отношении развития рака легких случайна крайне мала. Таким образом, отклоняем нулевую гипотезу, что означает наличие статистически значимых доказательств связи между курением и развитием рака легких в вашей выборке.***

***Также представлена оценка шансов (odds ratio). Значение показывает, что шансы на развитие рака легких у курящих в вашей выборке примерно в 14 раз выше, чем у некурящих.***

## 
