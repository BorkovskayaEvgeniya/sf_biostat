---
title: "HW6"
author: "Borkovskaya_Evgeniya"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(TrialSize)
```

## –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ 6: –†–∞—Å—á–µ—Ç –≤—ã–±–æ—Ä–∫–∏ –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

**–¢–µ–º–∞:** —Ä–∞—Å—á–µ—Ç –≤—ã–±–æ—Ä–∫–∏ –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.

**–¶–µ–ª—å:** –Ω–∞—É—á–∏—Ç—å—Å—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –≤—ã–±–æ—Ä–∫—É –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∫–æ–Ω–µ—á–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏.

## –û–ø–∏—Å–∞–Ω–∏–µ –î–ó

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —ç—Ç–æ–≥–æ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å –≤—ã–±–æ—Ä–∫–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ç–æ—á–µ–∫. –ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥, –ø–æ–ª—å–∑—É—è—Å—å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ —Ñ–æ—Ä–º—É–ª–∞–º–∏.

–ü—É—Å—Ç—å –Ω–∞—à —Å–ø–æ–Ω—Å–æ—Ä –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω, —á—Ç–æ–±—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏–º–µ–ª–æ 80% –º–æ—â–Ω–æ—Å—Ç—å, –∞ —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ ‚Äî 5%, –æ–∂–∏–¥–∞–µ–º—ã–π drop-out rate = 10%.

## –ó–∞–¥–∞–Ω–∏–µ 1 (3 –±–∞–ª–ª–∞)

–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –≤—ã–±–æ—Ä–∫—É –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–æ–π —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–≤—É—Ö–ø–µ—Ä–∏–æ–¥–Ω–æ–≥–æ cross-over –¥–∏–∑–∞–π–Ω–∞. –ò–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –∏–∑–≤–µ—Å—Ç–Ω–æ, —á—Ç–æ –¥–∏—Å–ø–µ—Ä—Å–∏—è —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 20% (ùûº\_*m= 0.20), –∞ —Ä–∞–∑–Ω–∏—Ü–∞ —Å—Ä–µ–¥–Ω–∏—Ö —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ‚àí10% (*ùõÜ *= ¬µ_test - ¬µ*\_reference). –ö–ª–∏–Ω–∏—Ü–∏—Å—Ç—ã —Å–æ–æ–±—â–∞—é—Ç –Ω–∞–º, —á—Ç–æ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 25% (ùõÖ= 0.25).

–í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —Å–ª–µ–¥—É—é—â–µ–π —Ñ–æ—Ä–º—É–ª–æ–π:

![](images/clipboard-3978036797.png)

```{r, include=TRUE}
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±–æ—Ä–∫–∏ –ø–æ —É—Å–ª–æ–≤–∏—é
alpha <- 0.05  
beta <- 0.20   
sigma_m <- 0.20  
epsilon <- -0.10  
delta <- 0.25  
drop_out_rate <-  0.1 

# Z-–∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
z_alpha_2 = abs(qnorm(alpha / 2))
z_beta <- abs(qnorm(beta))
```

```{r, include=TRUE}
# –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±–æ—Ä–∫–∏ –ø–æ —Ñ–æ—Ä–º—É–ª–µ
nom <- (Z_alpha_2 + Z_beta)^2 * sigma_m^2
det <- 2 * (delta - abs(epsilon))^2
n_total <- ceiling(nom/det)*2
sample_size_1 <- ceiling(n_total/(1 - drop_out_rate))

# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
print(paste("–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –±–µ–∑ —É—á–µ—Ç–∞ drop-out rate:", n_total))
print(paste("–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ —Å —É—á–µ—Ç–æ–º drop-out rate:", sample_size_1))
```

## –ó–∞–¥–∞–Ω–∏–µ 2 (3 –±–∞–ª–ª–∞)

–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –≤—ã–±–æ—Ä–∫—É –¥–ª—è –≥–∏–ø–æ—Ç–µ–∑—ã non-inferiority –¥–ª—è –¥–≤—É—Ö–≤—ã–±–æ—Ä–æ—á–Ω–æ–≥–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞. –ü—É—Å—Ç—å –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–∞—è —Ä–∞–∑–Ω–∏—Ü–∞¬†ùõÖ¬†= -0.1, —Ç–æ –µ—Å—Ç—å –º—ã –æ–∂–∏–¥–∞–µ–º —Ä–∞–∑–Ω–∏—Ü—É –Ω–µ –º–µ–Ω—å—à–µ 10%, –∞ –¥–æ–ª—é –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞¬†p2¬†= 0.65, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –Ω–∞–º –∏–∑–≤–µ—Å—Ç–Ω–æ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π, —á—Ç–æ –¥–æ–ª—è –æ—Ç–≤–µ—Ç–æ–≤ —É –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç¬†p1¬†= 0.85. –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≥—Ä—É–ø–ø —Ä–∞–≤–Ω–æ k = 1.

–í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —Å–ª–µ–¥—É—é—â–µ–π —Ñ–æ—Ä–º—É–ª–æ–π:

![](images/clipboard-3386146725.png)

```{r, include=TRUE}
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±–æ—Ä–∫–∏ –ø–æ —É—Å–ª–æ–≤–∏—é
alpha <- 0.05  
beta <- 0.20   
delta <- -0.1 
drop_out_rate <-  0.1
p1 <- 0.85
p2 <- 0.65
k <- 1

# Z-–∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
z_alpha_2 = abs(qnorm(alpha / 2))
z_beta <- abs(qnorm(beta))
```

```{r, include=TRUE}
# –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±–æ—Ä–∫–∏ –ø–æ —Ñ–æ—Ä–º—É–ª–µ
nom <- (Z_alpha_2 + Z_beta)^2 * (p1 * (1 - p1) + p2 *(1 - p2))
det <- (p1 - p2 - delta)^2
n_total <- ceiling(nom/det)*2
sample_size_2 <- ceiling(n_total/(1 - drop_out_rate))

# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
print(paste("–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –±–µ–∑ —É—á–µ—Ç–∞ drop-out rate:", n_total))
print(paste("–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ —Å —É—á–µ—Ç–æ–º drop-out rate:", sample_size_2))
```

## –ó–∞–¥–∞–Ω–∏–µ 3 (4 –±–∞–ª–ª–∞)

–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –≤—ã–±–æ—Ä–∫—É –¥–ª—è –≥–∏–ø–æ—Ç–µ–∑—ã equality –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è. –ú—ã —Ö–æ—Ç–∏–º —Å—Ä–∞–≤–Ω–∏—Ç—å –Ω–æ–≤—É—é —Ç–µ—Ä–∞–ø–∏—é –∏–Ω—Ñ–µ–∫—Ü–∏–∏, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—é—â–µ–π—Å—è –≤ –±–æ–ª—å–Ω–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —É –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ —Å –æ–∂–æ–≥–∞–º–∏, —Å –∑–æ–ª–æ—Ç—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –¥–∞–Ω–Ω—ã—Ö, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã—Ö —Å –ø–æ–º–æ—â—å—é —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –ö–æ–∫—Å–∞. –ü—É—Å—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤ ¬´–∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç / –Ω–æ–≤–∞—è —Ç–µ—Ä–∞–ø–∏—è¬ª, hazard ratio, HR = 2. –ú—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ 80% –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ ( d = 0.8) –º–æ–≥—É—Ç —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å —ç—Ç–∏–º –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ–º. –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è –≥—Ä—É–ø–ø —Ç–µ—Ä–∞–ø–∏–∏ —Ä–∞–≤–Ω—ã (p1 = p2 = 0.5).

–í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —Å–ª–µ–¥—É—é—â–µ–π —Ñ–æ—Ä–º—É–ª–æ–π:

![](images/clipboard-243825231.png)

```{r, include=TRUE}
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±–æ—Ä–∫–∏ –ø–æ —É—Å–ª–æ–≤–∏—é
alpha <- 0.05  
beta <- 0.20   
drop_out_rate <-  0.1
p1 <- 0.5
p2 <- 0.5
d <-  0.8
HR <- 2

# Z-–∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
z_alpha_2 = abs(qnorm(alpha / 2))
z_beta <- abs(qnorm(beta))
```

```{r, include=TRUE}
# –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±–æ—Ä–∫–∏ –ø–æ —Ñ–æ—Ä–º—É–ª–µ
nom <- (Z_alpha_2 + Z_beta)^2
det <- (log(HR))^2 * p1 * p2 * d
n_total <- ceiling(nom/det)*2
sample_size_3 <- ceiling(n_total/(1 - drop_out_rate))

# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
print(paste("–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –±–µ–∑ —É—á–µ—Ç–∞ drop-out rate:", n_total))
print(paste("–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ —Å —É—á–µ—Ç–æ–º drop-out rate:", sample_size_3))
```

–î–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Å–ª—É—á–∞—è —É–¥–∞–ª–æ—Å—å –ø–æ–¥–æ–±—Ä–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ TrialSize. –î–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—É—á–∏–≤—à–µ–≥–æ—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–º —Ä–∞—Å—á–µ—Ç —Å –ø–æ–º–æ—â—å—é –Ω–µ–µ.

```{r, include=TRUE}
# –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±–æ—Ä–∫–∏ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏
n = Cox.Equality(alpha = alpha, beta = beta, loghr = log(HR), p1 = 0.5, d = 0.8)
n_total = ceiling(n)*2
sample_size_3 <- ceiling(n_total/(1 - drop_out_rate))

# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
print(paste("–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –±–µ–∑ —É—á–µ—Ç–∞ drop-out rate:", n_total))
print(paste("–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ —Å —É—á–µ—Ç–æ–º drop-out rate:", sample_size_3))
```
